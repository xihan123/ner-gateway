<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NER 数据飞轮平台</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            },
            accent: {
              400: '#a78bfa',
              500: '#8b5cf6',
              600: '#7c3aed',
            }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    .fade-enter-active,
    .fade-leave-active {
      transition: all 0.3s ease;
    }
    
    .fade-enter-from,
    .fade-leave-to {
      opacity: 0;
      transform: translateX(30px);
    }
    
    .highlight-name {
      background: linear-gradient(120deg, #c084fc 0%, #818cf8 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 600;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .dark .glass-card {
      background: rgba(30, 41, 59, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .btn-gradient {
      background: linear-gradient(135deg, #0ea5e9 0%, #8b5cf6 100%);
      transition: all 0.2s ease;
    }
    
    .btn-gradient:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px -5px rgba(14, 165, 233, 0.4);
    }
    
    .btn-gradient:active {
      transform: translateY(0);
    }
    
    .shimmer {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    .dark .shimmer {
      background: linear-gradient(90deg, #334155 25%, #475569 50%, #334155 75%);
      background-size: 200% 100%;
    }
    
    .confidence-bar {
      transition: width 0.5s ease;
    }
    
    .pulse-dot {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .name-tag {
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    /* Toast 动画 */
    .toast-enter-active,
    .toast-leave-active {
      transition: all 0.3s ease;
    }
    
    .toast-enter-from {
      opacity: 0;
      transform: translateX(100%);
    }
    
    .toast-leave-to {
      opacity: 0;
      transform: translateX(100%);
    }
    
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.5);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(148, 163, 184, 0.7);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-violet-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 min-h-screen transition-colors duration-300">
  <div id="app"></div>

  <script>
    const { createApp, ref, reactive, computed, onMounted, nextTick, watch } = Vue

    createApp({
      setup() {
        // 响应式状态
        const reviews = ref([])
        const stats = ref({ total: 0, pending: 0, approved: 0, corrected: 0, rejected: 0 })
        const loading = ref(true)
        const error = ref(null)
        const darkMode = ref(false)
        // 修复: 使用 reactive 替代 ref({}) 以确保嵌套属性修改能被正确追踪
        const correctionInputs = reactive({})
        const submitting = reactive({})  // 同样改为 reactive
        const exportLoading = ref(false)
        
        // Toast 通知系统
        const toasts = ref([])
        let toastId = 0
        
        const showToast = (message, type = 'info') => {
          const id = ++toastId
          toasts.value.push({ id, message, type })
          setTimeout(() => {
            toasts.value = toasts.value.filter(t => t.id !== id)
          }, 3000)
        }
        
        const getToastColor = (type) => {
          switch (type) {
            case 'success': return 'bg-emerald-500'
            case 'error': return 'bg-rose-500'
            case 'warning': return 'bg-amber-500'
            default: return 'bg-blue-500'
          }
        }
        
        const getToastIcon = (type) => {
          switch (type) {
            case 'success': return 'M5 13l4 4L19 7'
            case 'error': return 'M6 18L18 6M6 6l12 12'
            case 'warning': return 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z'
            default: return 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'
          }
        }
        
        // 获取置信度颜色
        const getConfidenceColor = (confidence) => {
          if (confidence >= 0.9) return 'text-emerald-500'
          if (confidence >= 0.7) return 'text-amber-500'
          return 'text-rose-500'
        }
        
        const getConfidenceBg = (confidence) => {
          if (confidence >= 0.9) return 'bg-emerald-500'
          if (confidence >= 0.7) return 'bg-amber-500'
          return 'bg-rose-500'
        }

        // 修复 XSS: 先转义 HTML 特殊字符，再进行高亮替换
        const escapeHtml = (text) => {
          if (!text) return ''
          return String(text)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;')
        }
        
        // 高亮文本中的所有姓名 (XSS 安全版本)
        const highlightText = (text, names) => {
          if (!text) return ''
          // 先转义整个文本
          let escaped = escapeHtml(text)
          
          if (names && names.length > 0) {
            // 按长度降序排序，避免短名字影响长名字的匹配
            const sortedNames = [...names].filter(n => n).sort((a, b) => b.length - a.length)
            sortedNames.forEach(name => {
              if (name) {
                // 转义名字中可能存在的正则特殊字符
                const escapedName = name.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
                const regex = new RegExp(`(${escapedName})`, 'gi')
                // 在已转义的文本中进行替换
                escaped = escaped.replace(regex, '<span class="highlight-name">$1</span>')
              }
            })
          }
          return escaped
        }

        // 初始化修正输入
        const initCorrectionInput = (item) => {
          if (!correctionInputs[item.id]) {
            // 使用 reactive 确保数组变更能被追踪
            correctionInputs[item.id] = item.predicted_names ? [...item.predicted_names] : ['']
          }
        }

        // 添加姓名输入框
        const addNameInput = (item) => {
          initCorrectionInput(item)
          correctionInputs[item.id].push('')
        }

        // 移除姓名输入框
        const removeNameInput = (item, index) => {
          initCorrectionInput(item)
          if (correctionInputs[item.id].length > 1) {
            correctionInputs[item.id].splice(index, 1)
          }
        }

        // 获取统计信息
        const fetchStats = async () => {
          try {
            const res = await fetch('/api/stats')
            if (res.ok) {
              stats.value = await res.json()
            }
          } catch (e) {
            console.error('获取统计失败:', e)
          }
        }

        // 获取待审核列表
        const fetchReviews = async () => {
          loading.value = true
          error.value = null
          try {
            const res = await fetch('/api/reviews')
            if (!res.ok) {
              throw new Error(`获取数据失败: ${res.status} ${res.statusText}`)
            }
            const data = await res.json()
            reviews.value = (data.items || []).map(item => ({
              ...item,
              predicted_names: item.predicted_names || []
            }))
          } catch (e) {
            error.value = e.message
            reviews.value = []  // 清空数据，不使用假数据
            showToast('获取数据失败: ' + e.message, 'error')
          } finally {
            loading.value = false
          }
          await fetchStats()
        }

        // 通用请求处理函数 (带防抖保护)
        const processReviewAction = async (item, action, payload = {}) => {
          // 防抖检查
          if (submitting[item.id]) {
            return false
          }
          
          submitting[item.id] = true
          try {
            const res = await fetch(`/api/reviews/${item.id}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ action, ...payload })
            })
            
            if (!res.ok) {
              const errorData = await res.json().catch(() => ({}))
              throw new Error(errorData.error || `请求失败: ${res.status}`)
            }
            
            // 成功后从列表移除
            reviews.value = reviews.value.filter(r => r.id !== item.id)
            delete correctionInputs[item.id]
            await fetchStats()
            return true
          } catch (e) {
            console.error(`${action}失败:`, e)
            showToast(`${action}失败: ${e.message}`, 'error')
            return false
          } finally {
            submitting[item.id] = false
          }
        }

        // 确认准确
        const confirmCorrect = async (item) => {
          const success = await processReviewAction(item, 'approve')
          if (success) {
            showToast('已确认', 'success')
          }
        }

        // 修正姓名（支持多姓名）
        const correctNames = async (item) => {
          const names = (correctionInputs[item.id] || []).filter(n => n && n.trim())
          if (names.length === 0) {
            showToast('请输入至少一个姓名', 'warning')
            return
          }
          
          const success = await processReviewAction(item, 'correct', { names })
          if (success) {
            showToast('已修正', 'success')
          }
        }

        // 拒绝
        const rejectItem = async (item) => {
          const success = await processReviewAction(item, 'reject')
          if (success) {
            showToast('已拒绝', 'success')
          }
        }

        // 导出数据
        const exportData = async (format = 'bio') => {
          if (exportLoading.value) return
          
          exportLoading.value = true
          try {
            const res = await fetch(`/api/export?format=${format}`)
            if (!res.ok) {
              throw new Error(`导出失败: ${res.status}`)
            }
            
            const blob = await res.blob()
            const url = window.URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.href = url
            a.download = 'training_data.jsonl'
            document.body.appendChild(a)
            a.click()
            document.body.removeChild(a)
            window.URL.revokeObjectURL(url)
            showToast('导出成功', 'success')
          } catch (e) {
            console.error('导出失败:', e)
            showToast('导出失败: ' + e.message, 'error')
          } finally {
            exportLoading.value = false
          }
        }

        // 切换深色模式
        const toggleDarkMode = () => {
          darkMode.value = !darkMode.value
          document.documentElement.classList.toggle('dark', darkMode.value)
        }

        // 初始化
        onMounted(() => {
          fetchReviews()
          // 检测系统主题
          if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            darkMode.value = true
            document.documentElement.classList.add('dark')
          }
        })

        return {
          reviews,
          stats,
          loading,
          error,
          darkMode,
          correctionInputs,
          submitting,
          exportLoading,
          // Toast
          toasts,
          showToast,
          getToastColor,
          getToastIcon,
          // 方法
          getConfidenceColor,
          getConfidenceBg,
          highlightText,
          initCorrectionInput,
          addNameInput,
          removeNameInput,
          fetchStats,
          fetchReviews,
          confirmCorrect,
          correctNames,
          rejectItem,
          exportData,
          toggleDarkMode,
        }
      },
      template: `
        <div class="min-h-screen">
          <!-- Toast 通知容器 -->
          <div class="fixed top-4 right-4 z-[100] space-y-2">
            <TransitionGroup name="toast">
              <div v-for="toast in toasts" :key="toast.id"
                class="flex items-center gap-3 px-4 py-3 rounded-xl shadow-lg text-white min-w-[280px] max-w-md"
                :class="getToastColor(toast.type)">
                <svg class="w-5 h-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" :d="getToastIcon(toast.type)"/>
                </svg>
                <span class="text-sm font-medium">{{ toast.message }}</span>
              </div>
            </TransitionGroup>
          </div>

          <!-- 顶部导航 -->
          <header class="sticky top-0 z-50 glass-card border-b border-white/20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-xl btn-gradient flex items-center justify-center shadow-lg">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                  </div>
                  <div>
                    <h1 class="text-xl font-bold bg-gradient-to-r from-slate-800 to-slate-600 dark:from-white dark:to-slate-300 bg-clip-text text-transparent">
                      NER 数据飞轮
                    </h1>
                    <p class="text-xs text-slate-500 dark:text-slate-400">姓名识别数据收集与纠正</p>
                  </div>
                </div>
                
                <div class="flex items-center gap-3">
                  <!-- 导出按钮 -->
                  <button @click="exportData('bio')" 
                    :disabled="exportLoading"
                    class="flex items-center gap-2 px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl font-medium transition-all shadow-lg shadow-emerald-500/25 disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg v-if="exportLoading" class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <svg v-else class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    <span class="hidden sm:inline">导出训练数据</span>
                  </button>
                  
                  <!-- 刷新按钮 -->
                  <button @click="fetchReviews" 
                    class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
                    :class="{ 'animate-spin': loading }">
                    <svg class="w-5 h-5 text-slate-500 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                  </button>
                  
                  <!-- 深色模式切换 -->
                  <button @click="toggleDarkMode" 
                    class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                    <svg v-if="!darkMode" class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                    </svg>
                    <svg v-else class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </header>

          <!-- 主内容区 -->
          <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- 统计卡片 -->
            <div class="grid grid-cols-2 sm:grid-cols-5 gap-4 mb-8">
              <div class="glass-card rounded-2xl p-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                  </div>
                  <div>
                    <p class="text-2xl font-bold text-slate-800 dark:text-white">{{ stats.total }}</p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">总数据</p>
                  </div>
                </div>
              </div>
              
              <div class="glass-card rounded-2xl p-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-xl bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center">
                    <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  <div>
                    <p class="text-2xl font-bold text-amber-500">{{ stats.pending }}</p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">待审核</p>
                  </div>
                </div>
              </div>
              
              <div class="glass-card rounded-2xl p-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center">
                    <svg class="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="text-2xl font-bold text-emerald-500">{{ stats.approved }}</p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">已确认</p>
                  </div>
                </div>
              </div>
              
              <div class="glass-card rounded-2xl p-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-xl bg-violet-100 dark:bg-violet-900/30 flex items-center justify-center">
                    <svg class="w-5 h-5 text-violet-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                  </div>
                  <div>
                    <p class="text-2xl font-bold text-violet-500">{{ stats.corrected }}</p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">已修正</p>
                  </div>
                </div>
              </div>
              
              <div class="glass-card rounded-2xl p-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-xl bg-rose-100 dark:bg-rose-900/30 flex items-center justify-center">
                    <svg class="w-5 h-5 text-rose-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </div>
                  <div>
                    <p class="text-2xl font-bold text-rose-500">{{ stats.rejected }}</p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">已拒绝</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- 错误状态 -->
            <div v-if="error && !loading" class="glass-card rounded-2xl p-8 text-center mb-8">
              <div class="w-16 h-16 mx-auto rounded-full bg-rose-100 dark:bg-rose-900/30 flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-rose-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
              </div>
              <h3 class="text-lg font-semibold text-slate-800 dark:text-white mb-2">加载失败</h3>
              <p class="text-slate-500 dark:text-slate-400 mb-4">{{ error }}</p>
              <button @click="fetchReviews" 
                class="btn-gradient text-white px-6 py-2.5 rounded-xl font-medium shadow-lg">
                重试
              </button>
            </div>

            <!-- 加载状态 -->
            <div v-if="loading" class="space-y-4">
              <div v-for="i in 3" :key="i" class="glass-card rounded-2xl p-6">
                <div class="animate-pulse space-y-4">
                  <div class="h-4 shimmer rounded w-3/4"></div>
                  <div class="h-4 shimmer rounded w-1/2"></div>
                  <div class="flex gap-3 mt-4">
                    <div class="h-10 shimmer rounded-lg w-32"></div>
                    <div class="h-10 shimmer rounded-lg flex-1"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 空状态 -->
            <div v-else-if="reviews.length === 0 && !error" class="glass-card rounded-2xl p-12 text-center">
              <div class="w-20 h-20 mx-auto rounded-full bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center mb-4">
                <svg class="w-10 h-10 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
              </div>
              <h3 class="text-xl font-semibold text-slate-800 dark:text-white mb-2">审核完成！</h3>
              <p class="text-slate-500 dark:text-slate-400 mb-4">所有数据已处理完毕，可导出训练数据</p>
              <div class="flex gap-3 justify-center">
                <button @click="fetchReviews" 
                  class="btn-gradient text-white px-6 py-2.5 rounded-xl font-medium shadow-lg">
                  刷新获取新数据
                </button>
                <button @click="exportData('bio')" 
                  class="px-6 py-2.5 bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl font-medium shadow-lg">
                  导出训练数据
                </button>
              </div>
            </div>

            <!-- 审核列表 -->
            <TransitionGroup v-else-if="!error" name="fade" tag="div" class="space-y-4">
              <div v-for="item in reviews" :key="item.id" 
                class="glass-card rounded-2xl p-6 hover:shadow-xl transition-all duration-300">
                <div class="flex flex-col lg:flex-row lg:items-start gap-6">
                  <!-- 左侧：文本内容 -->
                  <div class="flex-1 space-y-4">
                    <!-- 置信度指示器 -->
                    <div class="flex items-center gap-3">
                      <span class="text-sm font-medium text-slate-500 dark:text-slate-400">置信度</span>
                      <div class="flex-1 max-w-32 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                        <div class="h-full confidence-bar rounded-full"
                          :class="getConfidenceBg(item.confidence)"
                          :style="{ width: (item.confidence * 100) + '%' }">
                        </div>
                      </div>
                      <span class="text-sm font-bold" :class="getConfidenceColor(item.confidence)">
                        {{ (item.confidence * 100).toFixed(1) }}%
                      </span>
                    </div>
                    
                    <!-- 原始文本 -->
                    <div class="bg-white/50 dark:bg-slate-800/50 rounded-xl p-4 border border-slate-200/50 dark:border-slate-700/50">
                      <p class="text-xs text-slate-400 mb-2 font-medium">原文</p>
                      <p class="text-slate-700 dark:text-slate-200 leading-relaxed"
                        v-html="highlightText(item.original_text, item.predicted_names)">
                      </p>
                    </div>
                    
                    <!-- 提取结果 - 支持多姓名 -->
                    <div class="flex items-start gap-4">
                      <div class="flex items-center gap-2 shrink-0">
                        <svg class="w-4 h-4 text-violet-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-sm text-slate-500 dark:text-slate-400">提取姓名：</span>
                      </div>
                      <div class="flex flex-wrap gap-2">
                        <span v-for="(name, idx) in item.predicted_names" :key="idx"
                          class="name-tag px-3 py-1 bg-gradient-to-r from-violet-100 to-purple-100 dark:from-violet-900/30 dark:to-purple-900/30 rounded-lg text-violet-700 dark:text-violet-300 font-semibold">
                          {{ name }}
                        </span>
                        <span v-if="!item.predicted_names || item.predicted_names.length === 0"
                          class="px-3 py-1 bg-slate-100 dark:bg-slate-700 rounded-lg text-slate-400">
                          未识别到姓名
                        </span>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 右侧：操作区 -->
                  <div class="lg:w-80 space-y-3 lg:border-l lg:border-slate-200/50 dark:lg:border-slate-700/50 lg:pl-6">
                    <p class="text-xs text-slate-400 font-medium">操作</p>
                    
                    <!-- 确认和拒绝按钮 -->
                    <div class="flex gap-2">
                      <button @click="confirmCorrect(item)" 
                        :disabled="submitting[item.id]"
                        class="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl font-medium transition-all shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg v-if="submitting[item.id]" class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <svg v-else class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        准确
                      </button>
                      <button @click="rejectItem(item)" 
                        :disabled="submitting[item.id]"
                        class="px-4 py-3 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-600 dark:text-slate-300 rounded-xl font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                      </button>
                    </div>
                    
                    <!-- 修正区域 - 支持多姓名 -->
                    <div class="space-y-2 p-3 bg-slate-50 dark:bg-slate-800/50 rounded-xl">
                      <p class="text-xs text-slate-500 font-medium">修正姓名（支持多个）</p>
                      
                      <!-- 姓名输入列表 -->
                      <div class="space-y-2">
                        <div v-for="(name, idx) in (correctionInputs[item.id] || item.predicted_names || [''])" :key="idx"
                          class="flex gap-2">
                          <input type="text" 
                            :value="correctionInputs[item.id] ? correctionInputs[item.id][idx] : (item.predicted_names && item.predicted_names[idx] ? item.predicted_names[idx] : '')"
                            @input="initCorrectionInput(item); correctionInputs[item.id][idx] = $event.target.value"
                            :placeholder="'姓名 ' + (idx + 1)"
                            class="flex-1 px-3 py-2 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-violet-500 focus:border-transparent transition-all placeholder:text-slate-400"
                          />
                          <button v-if="(correctionInputs[item.id] || item.predicted_names || ['']).length > 1"
                            @click="removeNameInput(item, idx)"
                            class="px-2 py-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                          </button>
                        </div>
                      </div>
                      
                      <!-- 添加和提交按钮 -->
                      <div class="flex gap-2 pt-2">
                        <button @click="addNameInput(item)"
                          class="flex items-center gap-1 px-3 py-2 text-sm text-violet-600 dark:text-violet-400 hover:bg-violet-50 dark:hover:bg-violet-900/20 rounded-lg transition-colors">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                          </svg>
                          添加姓名
                        </button>
                        <button @click="correctNames(item)"
                          :disabled="submitting[item.id] || !(correctionInputs[item.id] || item.predicted_names || []).some(n => n && n.trim())"
                          class="flex-1 px-4 py-2 bg-rose-500 hover:bg-rose-600 text-white rounded-lg font-medium transition-all shadow-lg shadow-rose-500/25 disabled:opacity-50 disabled:cursor-not-allowed">
                          提交修正
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </TransitionGroup>
          </main>

          <!-- 底部信息 -->
          <footer class="text-center py-6 text-sm text-slate-400">
            <p>NER 数据飞轮 · 全量数据收集 → 人工纠错 → 定期重训</p>
            <p class="mt-1">支持多姓名识别 · 导出 BIO 格式训练数据</p>
          </footer>
        </div>
      `
    }).mount('#app')
  </script>
</body>
</html>
